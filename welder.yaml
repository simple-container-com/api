schemaVersion: "1.8.1"
projectName: simple-container-api
projectRoot: .
version: 0.0-${git:commit.short}${arg:release-suffix:}
profiles:
  skip-test:
    activation:
      skip-tests: true
    build:
      env:
        SKIP_TESTS: "true"
modules:
  - name: api
    build:
      steps:
        - task: tools
        - task: build
tasks:
  tools:
    runOn: host
    script:
      - cat tools.go | grep _ | awk -F'"' '{print $2}' | xargs -tI % go get %
      - go mod download
      - go generate -tags tools
      - go mod tidy
  build:
    runOn: host
    script:
      - if [ "${SKIP_TESTS}" != 'true' ]; then go test ./...; else echo "Skipping tests"; fi
      - ${project:root}/bin/gofumpt -l -w .
      - go build ./...
      - go build -o ${project:root}/bin/sc ./cmd/sc
